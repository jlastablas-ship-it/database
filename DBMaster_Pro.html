<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DBMaster Pro — PWA Single File</title>

  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN (optional, allowed by requirements) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Minimal custom CSS (palette: slate, indigo, amber) */
    :root{
      --bg-slate: #0f172a;
      --panel-slate: #0b1220;
      --muted: #94a3b8;
      --indigo: #6366f1;
      --amber: #f59e0b;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%}
    body{
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #071029 0%, #071427 100%);
      color: #e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .sidebar { background: linear-gradient(180deg, rgba(15,23,42,0.8), rgba(2,6,23,0.8)); }
    .glass { background: var(--glass); border-radius:8px; }
    .toast { position: fixed; right: 1rem; bottom: 1rem; z-index: 60; }
    /* simple modal transitions */
    .modal-backdrop { transition: opacity .18s ease; }
    .sr-only { position: absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    /* small table tweaks */
    table { border-collapse: collapse; width:100%; }
    th, td { padding: 0.5rem 0.6rem; border-bottom: 1px solid rgba(255,255,255,0.03); text-align: left; font-size: 0.9rem; }
    .scroll-area { max-height: 60vh; overflow:auto; }
    /* badge */
    .badge { background: rgba(99,102,241,0.12); color: var(--indigo); padding: .18rem .5rem; border-radius: 999px; font-weight:600; font-size:0.75rem; }
  </style>
</head>
<body class="min-h-screen">

  <!-- Main layout -->
  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 p-4 sidebar glass hidden md:block">
      <div class="mb-6">
        <h1 class="text-2xl font-semibold text-indigo-100">DBMaster Pro</h1>
        <p class="text-sm text-muted-foreground text-gray-400">PWA · Single-file · IndexedDB</p>
      </div>

      <nav class="space-y-2" aria-label="Main navigation">
        <button data-view="dashboard" class="nav-btn w-full text-left px-3 py-2 rounded hover:bg-white/3 flex items-center gap-2">
          <!-- SVG Dashboard Icon (reemplazado por SVG válido) -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="text-indigo-200">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 13h8V3H3v10zM13 21h8v-8h-8v8zM13 3v10h8V3h-8zM3 21h8v-6H3v6z"></path>
          </svg>
          Dashboard
        </button>
        <button data-view="data-center" class="nav-btn w-full text-left px-3 py-2 rounded hover:bg-white/3 flex items-center gap-2">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="text-indigo-200">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 2l8 4v6l-8 4-8-4V6l8-4z"></path>
          </svg>
          Centro de Datos
        </button>
        <button data-view="explorer" class="nav-btn w-full text-left px-3 py-2 rounded hover:bg-white/3 flex items-center gap-2">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="text-indigo-200">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 2l2 7 7 2-7 2-2 7-2-7-7-2 7-2 2-7z"></path>
          </svg>
          Explorador de Tablas
        </button>
        <button data-view="schema" class="nav-btn w-full text-left px-3 py-2 rounded hover:bg-white/3 flex items-center gap-2">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="text-indigo-200">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7h2a2 2 0 0 1 2 2v10h10V9a2 2 0 0 1 2-2h2"></path>
          </svg>
          Editor de Esquemas
        </button>
        <button data-view="migration" class="nav-btn w-full text-left px-3 py-2 rounded hover:bg-white/3 flex items-center gap-2">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="text-amber-300">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 3v4m4 0V3M4 11h16M4 21h16"></path>
          </svg>
          Migración (T-SQL)
        </button>
      </nav>

      <div class="mt-6">
        <button id="export-backup" class="w-full text-sm py-2 px-3 rounded bg-indigo-600 hover:bg-indigo-500">Exportar Backup (JSON)</button>
        <button id="import-file" class="w-full mt-2 text-sm py-2 px-3 rounded bg-amber-500 hover:bg-amber-400">Importar CSV/JSON</button>
      </div>

      <div class="mt-6 text-xs text-gray-400">
        <div>Estado: <span id="status-db" class="badge">offline</span></div>
        <div class="mt-2">Usuario: <strong class="text-indigo-200">local</strong></div>
      </div>
    </aside>

    <!-- Main content -->
    <main class="flex-1 p-6 overflow-auto">
      <header class="flex items-center justify-between mb-6">
        <div>
          <h2 id="view-title" class="text-2xl font-semibold">Dashboard</h2>
          <p id="view-sub" class="text-sm text-gray-400">Resumen rápido de bases y tablas</p>
        </div>
        <div class="flex items-center gap-3">
          <button id="toggle-sidebar" class="md:hidden p-2 rounded bg-white/3" aria-label="Toggle sidebar">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12h18M3 6h18M3 18h18"/>
            </svg>
          </button>
          <div class="flex items-center gap-2">
            <label for="select-db" class="sr-only">Selecciona base</label>
            <select id="select-db" class="bg-transparent border rounded px-3 py-2 text-sm">
            </select>
          </div>
        </div>
      </header>

      <section id="content-area">
        <!-- Dashboard view -->
        <div id="view-dashboard" class="view">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="glass p-4">
              <h3 class="text-sm text-gray-300">Bases de Datos</h3>
              <div id="db-count" class="text-3xl font-bold mt-2">0</div>
            </div>
            <div class="glass p-4">
              <h3 class="text-sm text-gray-300">Tablas Total</h3>
              <div id="table-count" class="text-3xl font-bold mt-2">0</div>
            </div>
            <div class="glass p-4">
              <h3 class="text-sm text-gray-300">Registros Totales</h3>
              <div id="row-count" class="text-3xl font-bold mt-2">0</div>
            </div>
          </div>

          <div class="mt-6 glass p-4">
            <h4 class="font-semibold">Acciones rápidas</h4>
            <div class="mt-3 flex gap-2">
              <button id="create-db-btn" class="px-3 py-2 bg-indigo-600 rounded">Crear Base</button>
              <button id="create-table-btn" class="px-3 py-2 bg-indigo-500 rounded">Crear Tabla</button>
              <button id="sample-data-btn" class="px-3 py-2 bg-amber-500 rounded">Instalar Demo</button>
            </div>
            <p class="text-xs text-gray-400 mt-3">Sugerencias: crea una tabla y añade registros para probar import/export y migración.</p>
          </div>
        </div>

        <!-- Data Center view -->
        <div id="view-data-center" class="view hidden">
          <div class="glass p-4">
            <h3 class="font-semibold">Centro de Datos</h3>
            <div class="mt-3 flex gap-3">
              <input id="new-db-name" placeholder="nombre_db_demo" class="px-3 py-2 bg-transparent border rounded flex-1" />
              <button id="create-db" class="px-3 py-2 bg-indigo-600 rounded">Crear</button>
            </div>

            <div class="mt-4">
              <h4 class="text-sm text-gray-300">Bases existentes</h4>
              <ul id="db-list" class="mt-2 space-y-2"></ul>
            </div>
          </div>
        </div>

        <!-- Explorer view -->
        <div id="view-explorer" class="view hidden">
          <div class="flex gap-4">
            <div class="w-1/3 glass p-4">
              <h4 class="font-semibold">Tablas en <span id="explorer-db-name">-</span></h4>
              <div class="mt-3">
                <button id="create-table" class="px-3 py-2 bg-indigo-600 rounded">Nueva Tabla</button>
                <div class="mt-3 scroll-area">
                  <ul id="table-list" class="space-y-2"></ul>
                </div>
              </div>
            </div>

            <div class="flex-1 glass p-4">
              <div class="flex justify-between items-start">
                <h4 class="font-semibold">Vista de tabla: <span id="table-name-title">-</span></h4>
                <div class="flex gap-2">
                  <button id="btn-insert-row" class="px-3 py-2 bg-indigo-500 rounded">Insertar Registro</button>
                  <button id="btn-export-table" class="px-3 py-2 bg-amber-500 rounded">Exportar (JSON)</button>
                </div>
              </div>

              <div id="table-actions" class="mt-3 text-sm text-gray-400">
                <span id="table-schema-badge" class="badge">Esquema</span>
                <button id="rename-table" class="ml-3 px-2 py-1 bg-white/5 rounded text-xs">Renombrar</button>
                <button id="delete-table" class="ml-2 px-2 py-1 bg-red-600 rounded text-xs">Eliminar</button>
                <button id="import-to-table" class="ml-2 px-2 py-1 bg-amber-600 rounded text-xs">Importar CSV/JSON</button>
              </div>

              <div class="mt-4 scroll-area">
                <table id="table-rows">
                  <thead id="table-head"></thead>
                  <tbody id="table-body"></tbody>
                </table>
              </div>

              <div class="mt-4" id="pagination-area"></div>
            </div>
          </div>
        </div>

        <!-- Schema editor -->
        <div id="view-schema" class="view hidden">
          <div class="glass p-4">
            <h3 class="font-semibold">Editor de Esquemas</h3>
            <div class="mt-3">
              <label class="text-sm">Seleccionar base</label>
              <select id="schema-select-db" class="bg-transparent border rounded px-3 py-2 mt-2"></select>
            </div>
            <div class="mt-3">
              <label class="text-sm">Seleccionar tabla</label>
              <select id="schema-select-table" class="bg-transparent border rounded px-3 py-2 mt-2"></select>
            </div>

            <div id="schema-editor-area" class="mt-4 hidden">
              <h4 class="font-semibold">Columnas</h4>
              <div id="columns-list" class="mt-2 space-y-2"></div>

              <div class="mt-3 flex gap-2">
                <input id="col-name" placeholder="columna" class="px-3 py-2 bg-transparent border rounded" />
                <select id="col-type" class="px-3 py-2 bg-transparent border rounded">
                  <option value="TEXTO">TEXTO</option>
                  <option value="NUMERO">NÚMERO</option>
                </select>
                <label class="inline-flex items-center gap-2 ml-2"><input id="col-pk" type="checkbox" /> PK</label>
                <button id="add-column" class="px-3 py-2 bg-indigo-600 rounded">Añadir</button>
              </div>

              <div class="mt-4 text-sm text-gray-400">
                Nota: Cambios en columnas crean nuevas definiciones; eliminar columnas no borra datos históricos automáticamente.
              </div>
            </div>
          </div>
        </div>

        <!-- Migration view -->
        <div id="view-migration" class="view hidden">
          <div class="glass p-4">
            <h3 class="font-semibold">Generador de Migración a SQL Server (T-SQL)</h3>
            <div class="mt-3">
              <label class="text-sm">Seleccionar base</label>
              <select id="migration-db" class="bg-transparent border rounded px-3 py-2 mt-2"></select>
            </div>

            <div class="mt-3">
              <label class="text-sm">Incluir datos (INSERTs)</label>
              <input id="migration-include-data" type="checkbox" checked class="ml-2" />
            </div>

            <div class="mt-4 flex gap-2">
              <button id="generate-sql" class="px-3 py-2 bg-amber-500 rounded">Generar SQL</button>
              <button id="copy-sql" class="px-3 py-2 bg-indigo-600 rounded">Copiar</button>
            </div>

            <div class="mt-4">
              <textarea id="sql-output" rows="12" class="w-full bg-black/30 p-3 rounded text-sm"></textarea>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal container (single reusable modal) -->
  <div id="modal-root" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="modal-backdrop absolute inset-0 bg-black/60"></div>
    <div id="modal" role="dialog" aria-modal="true" class="relative glass p-4 w-full max-w-2xl rounded max-h-[90vh] overflow-auto">
      <div id="modal-content"></div>
      <div class="mt-4 text-right">
        <button id="modal-cancel" class="px-3 py-2 bg-white/5 rounded mr-2">Cerrar</button>
        <button id="modal-ok" class="px-3 py-2 bg-indigo-600 rounded">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Toast area -->
  <div id="toast-root" class="toast space-y-2"></div>

  <!-- Hidden file input for import -->
  <input id="file-input" type="file" accept=".json,.csv,application/json,text/csv" class="hidden" />

  <!-- Single-file JS: implements IndexedDB, metadata, UI, import/export, migration. -->
  <script>
/*
  DBMaster Pro — Single-file app
  - IndexedDB primary storage (object store per table)
  - Metadata (schemas) in localStorage (fast access)
  - Async/await for all IDB operations
  - Custom modals and toasts (no alert/confirm)
  - Demo DB created on first run
*/

/* ------------------------
   Utilities and constants
   ------------------------ */
const IDB_NAME = 'DBMaster_IndexedDB';
const META_KEY = 'dbmaster_meta_v1'; // localStorage key for schemas
const VERSION_KEY = 'dbmaster_idb_version';
const DEFAULT_IDB_VERSION = 1;

// Helpers for toasts and modals
const toastRoot = document.getElementById('toast-root');
function showToast(message, type='info', ttl=4000){
  const el = document.createElement('div');
  el.className = 'glass p-3 rounded shadow-sm';
  el.style.minWidth = '220px';
  el.innerHTML = `
    <div class="flex items-center gap-2">
      <div class="flex-1 text-sm">${message}</div>
      <div><button class="text-xs text-gray-300 close-btn">x</button></div>
    </div>`;
  if(type==='error') el.style.borderLeft = '4px solid ' + 'rgba(255,0,64,0.7)';
  if(type==='success') el.style.borderLeft = '4px solid ' + 'rgba(34,197,94,0.7)';
  toastRoot.appendChild(el);
  const closeBtn = el.querySelector('.close-btn');
  closeBtn.addEventListener('click', ()=> el.remove());
  setTimeout(()=> { if(el.parentNode) el.remove(); }, ttl);
  return el;
}

// Modal system
const modalRoot = document.getElementById('modal-root');
const modalContent = document.getElementById('modal-content');
const modalOk = document.getElementById('modal-ok');
const modalCancel = document.getElementById('modal-cancel');
let modalResolve = null;
function showModal(html, opts={okText:'Guardar', cancelText:'Cerrar', focusSelector:null}){
  modalContent.innerHTML = '';
  if(typeof html === 'string') modalContent.innerHTML = html;
  else modalContent.appendChild(html);
  modalOk.textContent = opts.okText || 'Guardar';
  modalCancel.textContent = opts.cancelText || 'Cerrar';
  modalRoot.classList.remove('hidden');
  setTimeout(()=> modalRoot.classList.add('flex'), 20);
  if(opts.focusSelector){
    setTimeout(()=> {
      const el = modalContent.querySelector(opts.focusSelector);
      if(el) el.focus();
    }, 80);
  }
  return new Promise((res)=>{
    modalResolve = res;
  });
}
modalOk.addEventListener('click', ()=> { modalRoot.classList.add('hidden'); modalResolve && modalResolve(true); });
modalCancel.addEventListener('click', ()=> { modalRoot.classList.add('hidden'); modalResolve && modalResolve(false); });
document.getElementById('modal-root').addEventListener('click', (e)=>{
  if(e.target.id === 'modal-root') { modalRoot.classList.add('hidden'); modalResolve && modalResolve(false); }
});

/* ------------------------
   Metadata management
   Stored in localStorage for quick access
   Structure:
   {
     databases: {
       dbName: {
         tables: {
           tableName: {
             columns: [{name, type:'TEXTO'|'NUMERO', pk: boolean}],
             createdAt: timestamp
           }, ...
         },
         createdAt: timestamp
       }, ...
     }
   }
*/
function loadMeta(){
  try {
    const raw = localStorage.getItem(META_KEY);
    if(!raw) return {databases:{}};
    return JSON.parse(raw);
  } catch (e) {
    console.error('Error loading meta', e);
    return {databases:{}};
  }
}
function saveMeta(meta){
  localStorage.setItem(META_KEY, JSON.stringify(meta));
}

/* ------------------------
   IndexedDB helpers (async/await)
   We store one IDB database (IDB_NAME) and create/delete objectStores per table.
   When creating or deleting a store we bump the DB version and perform changes in onupgradeneeded.
   ------------------------ */

function getCurrentVersion(){
  const v = parseInt(localStorage.getItem(VERSION_KEY) || DEFAULT_IDB_VERSION, 10);
  return isNaN(v) ? DEFAULT_IDB_VERSION : v;
}

function setCurrentVersion(v){
  localStorage.setItem(VERSION_KEY, String(v));
}

/**
 * Open IDB with current version
 * Returns IDBDatabase
 */
function openIdb(versionOverride){
  return new Promise((resolve, reject) => {
    const v = versionOverride || getCurrentVersion();
    const req = indexedDB.open(IDB_NAME, v);
    req.onsuccess = () => resolve(req.result);
    req.onerror = (ev) => reject(req.error);
    // Note: we intentionally do not handle onupgradeneeded here, upgrades happen in upgradeDatabase
  });
}

/**
 * Perform an upgrade applying create/delete/rename actions.
 * actions: [{type:'create', storeName, keyPath|null}, {type:'delete', storeName}, ...]
 */
async function upgradeDatabase(actions = []){
  // increment version
  const newVersion = getCurrentVersion() + 1;
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(IDB_NAME, newVersion);
    req.onupgradeneeded = (ev) => {
      const db = req.result;
      try {
        for(const a of actions){
          if(a.type === 'create'){
            const opts = {};
            if(a.keyPath) opts.keyPath = a.keyPath;
            else opts.autoIncrement = true;
            if(db.objectStoreNames.contains(a.storeName)){
              // already exists; skip
              continue;
            }
            db.createObjectStore(a.storeName, opts);
          } else if(a.type === 'delete'){
            if(db.objectStoreNames.contains(a.storeName)){
              db.deleteObjectStore(a.storeName);
            }
          } else if(a.type === 'clear'){
            if(db.objectStoreNames.contains(a.storeName)){
              const tx = ev.currentTarget.transaction;
              try { 
                const os = tx.objectStore(a.storeName); 
                os.clear();
              } catch(e){ console.warn('clear failed', e); }
            }
          }
        }
      } catch (e) {
        console.error('upgrade error', e);
        reject(e);
      }
    };
    req.onsuccess = () => {
      setCurrentVersion(newVersion);
      resolve(req.result);
    };
    req.onerror = () => reject(req.error);
  });
}

/* Generic IDB transaction helpers */
async function idbAdd(storeName, value){
  const db = await openIdb();
  return new Promise((resolve, reject) => {
    const tx = db.transaction(storeName, 'readwrite');
    const os = tx.objectStore(storeName);
    const req = os.add(value);
    req.onsuccess = (e) => resolve(req.result);
    req.onerror = (e) => reject(req.error);
  });
}
async function idbPut(storeName, value){
  const db = await openIdb();
  return new Promise((resolve, reject) => {
    const tx = db.transaction(storeName, 'readwrite');
    const os = tx.objectStore(storeName);
    const req = os.put(value);
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => reject(req.error);
  });
}
async function idbGetAll(storeName){
  const db = await openIdb();
  return new Promise((resolve, reject) => {
    if(!db.objectStoreNames.contains(storeName)) { resolve([]); return; }
    const tx = db.transaction(storeName, 'readonly');
    const os = tx.objectStore(storeName);
    const req = os.getAll();
    req.onsuccess = ()=> resolve(req.result || []);
    req.onerror = ()=> reject(req.error);
  });
}
async function idbGet(storeName, key){
  const db = await openIdb();
  return new Promise((resolve, reject) => {
    if(!db.objectStoreNames.contains(storeName)) { resolve(undefined); return; }
    const tx = db.transaction(storeName, 'readonly');
    const os = tx.objectStore(storeName);
    const req = os.get(key);
    req.onsuccess = ()=> resolve(req.result);
    req.onerror = ()=> reject(req.error);
  });
}
async function idbDelete(storeName, key){
  const db = await openIdb();
  return new Promise((resolve, reject) => {
    if(!db.objectStoreNames.contains(storeName)) { resolve(); return; }
    const tx = db.transaction(storeName, 'readwrite');
    const os = tx.objectStore(storeName);
    const req = os.delete(key);
    req.onsuccess = ()=> resolve();
    req.onerror = ()=> reject(req.error);
  });
}

/* ------------------------
   High-level DB operations (metadata aware)
   ------------------------ */
function storeName(dbName, tableName){
  // safe store name
  return `${dbName}__${tableName}`;
}

/**
 * Create new database (metadata only)
 */
function createDatabaseMeta(dbName){
  const meta = loadMeta();
  if(meta.databases[dbName]) {
    showToast('La base ya existe', 'error'); 
    return false;
  }
  meta.databases[dbName] = { tables: {}, createdAt: Date.now() };
  saveMeta(meta);
  return true;
}

// --- Minimal UI initializer (added patch) ---
(function(){
  function showViewById(id){
    document.querySelectorAll('.view').forEach(v=>{
      if(v.id === id) v.classList.remove('hidden');
      else v.classList.add('hidden');
    });
  }

  function setTitle(title, subtitle){
    const t = document.getElementById('view-title');
    const s = document.getElementById('view-sub');
    if(t) t.textContent = title || 'DBMaster Pro';
    if(s && subtitle !== undefined) s.textContent = subtitle;
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    // Nav buttons (data-view)
    document.querySelectorAll('[data-view]').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const view = btn.getAttribute('data-view');
        if(!view) return;
        showViewById('view-' + view);
        const label = btn.textContent.trim();
        setTitle(label);
      });
    });

    // Sidebar toggle (mobile)
    const toggle = document.getElementById('toggle-sidebar');
    if(toggle){
      toggle.addEventListener('click', ()=> {
        const sb = document.getElementById('sidebar');
        if(!sb) return;
        sb.classList.toggle('hidden');
      });
    }

    // Export backup (stub)
    const exportBtn = document.getElementById('export-backup');
    if(exportBtn){
      exportBtn.addEventListener('click', ()=>{
        try {
          const meta = (typeof loadMeta === 'function') ? loadMeta() : null;
          const payload = meta ? JSON.stringify(meta, null, 2) : JSON.stringify({msg:'no meta available'});
          const blob = new Blob([payload], {type:'application/json'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'dbmaster_backup.json';
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          showToast('Backup preparado y descargado', 'success');
        } catch (e){
          console.warn(e);
          showToast('Error al exportar backup', 'error');
        }
      });
    }

    // Import file button -> click hidden file input
    const importBtn = document.getElementById('import-file');
    const fileInput = document.getElementById('file-input');
    if(importBtn && fileInput){
      importBtn.addEventListener('click', ()=> fileInput.click());
      fileInput.addEventListener('change', (ev)=>{
        const f = ev.target.files && ev.target.files[0];
        if(!f){ showToast('No se seleccionó archivo', 'error'); return; }
        showToast('Archivo seleccionado: ' + f.name, 'info');
      });
    }

    // Quick actions (stubs)
    const createDbBtn = document.getElementById('create-db-btn');
    if(createDbBtn){
      createDbBtn.addEventListener('click', async ()=> {
        const r = await showModal(`<div>
            <label>Nombre de la base</label>
            <input id="tmp-db-name" class="px-3 py-2 mt-2" />
          </div>`, {okText:'Crear', cancelText:'Cancelar', focusSelector:'#tmp-db-name'});
        if(r){
          const nameEl = modalContent.querySelector('#tmp-db-name');
          const name = nameEl && nameEl.value ? nameEl.value.trim() : '';
          if(!name) { showToast('Nombre vacio', 'error'); return; }
          if(typeof createDatabaseMeta === 'function'){
            const ok = createDatabaseMeta(name);
            if(ok) showToast(`Base "${name}" creada (meta)", 'success');
            else showToast('No se pudo crear (posible duplicado)', 'error');
          } else {
            showToast('Función createDatabaseMeta no encontrada', 'error');
          }
        }
      });
    }

    const createTableBtn = document.getElementById('create-table-btn');
    if(createTableBtn){
      createTableBtn.addEventListener('click', ()=> showToast('Crear tabla: funcionalidad no implementada (stub)', 'info'));
    }
    const sampleBtn = document.getElementById('sample-data-btn');
    if(sampleBtn){
      sampleBtn.addEventListener('click', ()=> showToast('Instalando demo (stub)', 'info'));
    }

    // Ensure initial view is dashboard
    showViewById('view-dashboard');
    setTitle('Dashboard', 'Resumen rápido de bases y tablas');
  });
})();

  </script>
</body>
</html>